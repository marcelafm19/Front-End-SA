<div class="container mt-4">
  <div class="header-section">
    <div class="logo-and-title">
      <h2 class="mb-4 border-bottom border-3 border-danger">Extrato</h2>
    </div>
  </div>

  <div class="d-flex justify-content-end mb-3">
    <button type="button" class="btn btn-outline-secondary" (click)="alternarResumo()" [attr.aria-pressed]="mostrarResumo">
      {{ mostrarResumo ? 'Ver tabela completa' : 'Ver tabela resumida' }}
    </button>
  </div>

  <table *ngIf="!mostrarResumo" class="table table-bordered table-hover table-striped align-middle">
    <thead class="table-dark">
      <tr>
        <th>Data</th>
        <th>Valor</th>
        <th>Tipo da Operação</th> <th>Descrição</th> <th>Categoria</th>
        <th>Tipo da Categoria</th>
        <th>Usuário</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let transacao of listaTransacoes">
        <td>{{ transacao.data | date:'dd/MM/yyyy' }}</td>
        <td [ngClass]="{'text-danger': transacao.tipo === 'Débito', 'text-success': transacao.tipo === 'Crédito'}">
          {{ transacao.valor | currency:'BRL':'symbol':'1.2-2' }}
        </td>
        <td>{{ transacao.tipoOperacao }}</td> <td>{{ transacao.descricaoDetalhada }}</td> <td>{{ transacao.categoria }}</td>
        <td>{{ transacao.categoriaTipo }}</td>
        <td>{{ transacao.usuario }}</td>
      </tr>
      <tr *ngIf="listaTransacoes.length === 0">
        <td colspan="7" class="text-center">Nenhuma transação encontrada.</td>
      </tr>
    </tbody>
  </table>

  <table *ngIf="mostrarResumo" class="table table-bordered table-hover table-striped align-middle">
    <thead class="table-dark">
      <tr>
        <th>Valor</th>
        <th>Tipo da Operação</th>
        <th>Descrição</th>
        <th>Usuário</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let transacao of listaTransacoes">
        <td [ngClass]="{'text-danger': transacao.tipo === 'Débito', 'text-success': transacao.tipo === 'Crédito'}">
          {{ transacao.valor | currency:'BRL':'symbol':'1.2-2' }}
        </td>
        <td>{{ transacao.tipoOperacao }}</td>
        <td>{{ transacao.descricaoDetalhada }}</td>
        <td>{{ transacao.usuario }}</td>
      </tr>
      <tr *ngIf="listaTransacoes.length === 0">
        <td colspan="4" class="text-center">Nenhuma transação encontrada.</td>
      </tr>
    </tbody>
  </table>

  <div class="row mt-4">
    <div class="col-md-6 offset-md-3">
      <div class="card text-white bg-secondary mb-3">
        <div class="card-header">Balanço Atual (Receitas - Despesas)</div>
        <div class="card-body text-center">
          <h4 class="card-title">Balanço Total: {{ balanco | currency:'BRL':'symbol':'1.2-2' }}</h4>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card border-info mb-3">
        <div class="card-header bg-info text-white">Balanço por Categoria</div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between align-items-center"
                *ngFor="let categoria of balancoPorCategoria | keyvalue">
              {{ categoria.key }}:
              <span [ngClass]="{'text-danger': categoria.value < 0, 'text-success': categoria.value >= 0}">
                {{ categoria.value | currency:'BRL':'symbol':'1.2-2' }}
              </span>
            </li>
            <li class="list-group-item text-center" *ngIf="(balancoPorCategoria | keyvalue).length === 0">
              Nenhum balanço por categoria disponível.
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-success mb-3">
        <div class="card-header bg-success text-white">Balanço por Usuário</div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between align-items-center"
                *ngFor="let usuario of balancoPorUsuario | keyvalue">
              {{ usuario.key }}:
              <span [ngClass]="{'text-danger': usuario.value < 0, 'text-success': usuario.value >= 0}">
                {{ usuario.value | currency:'BRL':'symbol':'1.2-2' }}
              </span>
            </li>
            <li class="list-group-item text-center" *ngIf="(balancoPorUsuario | keyvalue).length === 0">
              Nenhum balanço por usuário disponível.
            </li>
          </ul>
        </div>
      </div>
    </div>
